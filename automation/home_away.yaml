- alias: Away Actions
  hide_entity: false
  initial_state: off
  trigger:
    - platform: state
      entity_id: group.all_devices
      to: 'not_home'
  action:
    - service: climate.set_away_mode
      entity_id: climate.family_room
      data:
        away_mode: true
    - service: scene.turn_on
      entity_id: scene.bedtime
    - service: notify.ios_steves_iphone_x
      data:
        message: "Away"

- alias: Arrive Actions
  hide_entity: false
  initial_state: off
  trigger:
    - platform: state
      entity_id: group.all_devices
      to: 'home'
  action:
    - service: climate.set_away_mode
      entity_id: climate.family_room
      data:
        away_mode: false
    - service: notify.ios_steves_iphone_x
      data:
        message: "Home"
    - condition: or  # 'when dark' condition: either after sunset or before sunrise
      conditions:
        - condition: sun
          after: sunset
        - condition: sun
          before: sunrise
    - service: light.turn_on
      data:
        entity_id: light.family_room_lights
        brightness: 128

- alias: HomeKit Steve
  hide_entity: false
  initial_state: on
  trigger:
    - platform: state
      entity_id: device_tracker.steves_iphone_x
  action:
    - service_template: >
       {% if states.device_tracker.steves_iphone_x.state == 'home'  %}
         input_boolean.turn_on
       {% else %}
         input_boolean.turn_off
       {% endif %}
      entity_id: input_boolean.steve_homekit

- alias: HomeKit Airie
  hide_entity: false
  initial_state: on
  trigger:
    - platform: state
      entity_id: device_tracker.airies_iphone_se
  action:
    - service_template: >
       {% if states.device_tracker.airies_iphone_se.state == 'home'  %}
         input_boolean.turn_on
       {% else %}
         input_boolean.turn_off
       {% endif %}
      entity_id: input_boolean.airie_homekit
